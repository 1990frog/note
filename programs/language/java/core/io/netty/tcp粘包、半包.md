[TOC]

# 什么是粘包和半包
发送：ABC DEF
接收：AB CD EF

# 粘包的主要原因
+ 发送方每次写入数据 < 套接字缓冲区大小
+ 接收方读取套接字缓冲区数据不够及时

# 半包的主要原因
+ 发送方写入数据 > 套接字缓冲区大小
+ 发送的数据大于协议MTU（maximum transamission unit，最大传输单元）,必须拆包

# 为什么TCP应用中会出现粘包和半包现象
tcp是流式协议，消息无边界

# 解决问题的根本手段：找出消息的边界
|                                  方式                                   |                               查找消息边界方式                               |                             优点                             |                                                             缺点                                                             | 推荐度 |
| -------------------------------------------------------- | --------------------------------------------------------------------- | ------------------------------------------------ | ------------------------------------------------------------------------------------------------ | --------- |
| TCP连接改成短连接，一个请求一个短连接 | 建立连接到释放连接之间的信息即为传输信息             | 简单                                                         | 效率低下                                                                                                                 | 不推荐 |
| 固定长度:\|ABC\|DEF\|GHI\|                      | 满足固定长度即可                                                             | 简单                                                         | 浪费空间                                                                                                                 | 不推荐 |
| 分隔符:\|ABC\nDEF\n\|                                 | 分隔符之间                                                                         | 空间不浪费，也比较简单                     | 内容本身出现分隔符时需转义，所以需要扫描内容                                         | 推荐     |
| 固定长度字段存个内容的长度信息                | 先解析固定长度的字段获取长度，然后读取后续字段 | 精确定位用户数据，内容也不用转义 | 长度理论上有限制，需提前预知可能的最大长度从而定义长度占用字节数 | 推荐+   |
| 其他方式                                                            | 每种都不同，例如JSON可以看{}是否应已经成对         |                                                                  |                                                                                                                                  |              |

# Netty对三种常用封帧方式的支持
固定长度：FixedLengthFrameDecoder
分隔符：DelimiterBasedFrameDecoder
固定长度字段存个内容的长度信息：LengthFieldBasedFrameDecoder
