[TOC]

![633px-Segment_tree](https://gitee.com/caijingquan/imagebed/raw/master/1602316986_20200212213417063_277611230.png)

线段树（英语：Segment tree）是一种二叉树形数据结构，用以存储区间或线段，并且允许快速查询结构内包含某一点的所有区间。
一个包含n个区间的线段树，空间复杂度为O(n)，查询的时间复杂度则为O(logn+k)，其中k是符合条件的区间数量。
此数据结构亦可推广到高维度。
对于给定的区间
更新：更新区间中一个元素或者一个区间的值
查询一个区间[i,j]的最大值，最小值，或者区间数字和

+ 线段树不是完全二叉树（叶子节点可能与父母节点在一层）
+ 线段树是平衡二叉树（最大的深度与最小的深度的差最多为1）
+ 用null填补可以看做满二叉树

# 为什么要使用线段树

|     | 使用数组实现 | 使用线段树 |
| --- | ---------- | -------- |
| 更新 | O(n)       | O(logn)  |
| 查询 | O(n)       | O(logn)  |

# 什么是线段树
如果区间有n个元素，数组表示需要有多个节点？

| 层数 |   个数    |
| --- | --------- |
| 0   | 1         |
| 1   | 2         |
| 2   | 4         |
| 3   | 8         |
| ... | ...       |
| h-1 | $2^{h-1}$ |

对满二叉树：
h层，一共有$2^h-1$个节点（大约是$2^h$）,最后一层（h-1层），有$2^{h-1}$个节点，最后一层的节点数大致等于前面所有层节点之和

如果区间有n个元素，数组表示需要多少个节点？
如果$n=2^k$，只需要2n个空间（不考虑添加元素）
如果$n=2^k+1$,需要4n的空间（不考虑添加元素）

# 实现方式
+ 数组实现
+ 链表实现


整形溢出
int mid = (l+r)/2
int mid = l + (r-l)/2

区间要看业务要求


递归：考虑递归到底的情况

# 线段树相关的问题
+ 对一个区间进行更新
+ 惰性更新（使用lazy数组记录未更新的内容）
+ 二维线段树
+ 动态线段树

# 拓展
区间操作相关的另外一个重要数据结构
树状数组（Binary Index Tree）

区间相关问题
RMQ
Range Minimun Query