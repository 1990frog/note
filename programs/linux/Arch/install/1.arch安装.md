[TOC]

# 前期准备
## 下载
[arch](https://archlinux.org/download/)
## 烧盘
rufus dd模式
## 磁盘分区
```
# 查看磁盘
> fdisk -l

# 分区，设置BOOT与HOME
> cfdisk /dev/nvme0n1

# EFI分区格式要求FAT32
> mkfs.fat -F 32 /dev/nvme0n1p1

# 设置主分区格式EXT4
> mkfs.ext4 /dev/nvme0n1p2
```
## 磁盘挂载至安装U盘
U盘是一个系统，将目标磁盘挂载并在其上安装系统，挂载目标是/mnt，它会作为我们系统安装的目标目录
```
> mount /dev/nvme0n1p2 /mnt
> mkdir /mnt/boot
> mount /dev/nvme0n1p1 /mnt/boot
```

# 安装系统
## 核心组件
pacstrap是pacman的一个前端
+ base：基础组件
+ linux：Linux内核
+ linux-firmware：系统固件，包含一些驱动程序
+ base-devel：开发控件
+ intel-ucode/amd-ucode：处理器微码
+ grub：引导
+ efibootmgr：uefi管理工具
+ os-prober：可以找到win的efi分区
```
> pacstrap /mnt base linux linux-firmware base-devel intel-ucode/amd-ucode grub efibootmgr
```
pacman -S dhcpcd                     #dhcp服务必要的软件
pacman -S net-tools                  #net-tools软件包中包含arp，ifconfig，netstat，route其中我使用ifconfig命令（开启网卡，设置网卡ip，查看网卡状态）和route命令（设置默认网关，进行有线联网）比较多
pacman -S iwd                        #主要包含iwctl命令，用来连接wifi
pacman -S wpa_supplicant             #连接wpa加密的wifi需要用到。

## 生成fstab
fstab是自动挂载文件系统不可或缺的文件，缺少则无法启动。genfstab这个工具只在安装环境中提供
```
> genfstab -U /mnt > /mnt/etc/fstab
```

## 切换到目标系统
有的操作只能在chroot中进行，有的只能在外面进行
```
# 切换挂载磁盘arch
> arch-chroot /mnt
# 退出
> exit
```

## 安装启动器
```
# 安装grub到硬盘
> grub-install --target = x86_64-efi --efi-directory = /boot
# 生成配置文件
> grub-mkconfig > /boot/grub/grub.cfg
```

## 安装常用软件
+ neovim：宇宙第一编辑器
+ openssh：ssh服务
+ reflector：是一个 Python 脚本；它可以从 Arch Linux Mirror Status 页面获取最新的镜像列表，然后筛选出最新的镜像并按速度排序，最后将结果写入到 /etc/pacman.d/mirrorlist 文件
+ jdk8-openjdk
+ python3
```
> pacman -S neovim openssh reflector jdk8-openjdk
> ln -s nvim /usr/bin/vim
> ln -s nvim /usr/bin/vi
```

# 用户
## 安装sudo
arch要自己安装
```
> pacman -S sudo
```

## 设置root密码
理论上有了sudo，我们就不必再用root账号了。但这并不表示绝对安全，因为TTY模式下还能输入root账号名来登录root账号，而且默认是没有密码的！
更重要的是，访客也可以通过ssh等来直接登录！
```
> sudo -i
> passwd
```

## 授予sudo权限
使用visudo工具来编辑sudo的配置文件，所有能使用sudo来执行命令的用户，都应当是“wheel”这个用户组的成员。因此，我们要在wheel组的用户使用sudo
```
> visudo
// 取消[%whell All = (All) All]的注释
```
在Linux中wheel组就类似于一个管理员的组。
通常在LUNIX下，即使我们有系统管理员root的权限，也不推荐用root用户登录。一般情况下用普通用户登录就可以了，在需要root权限执行一些操作时，再su登录成为root用户。但是，任何人只要知道了root的密码，就都可以通过su命令来登录为root用户--这无疑为系统带来了安全隐患。所以，将普通用户加入到wheel组，被加入的这个普通用户就成了管理员组内的用户，但如果不对一些相关的配置文件进行配置，这个管理员组内的用户与普通用户也没什么区别--就像警察下班后，没有带枪、穿这便衣和普通人（用户）一样，虽然他的的确确是警察。

## 创建用户
创建一个新用户，以后登录就用它，配合sudo，取代默认的root用户，提高安全性。
使用useradd来创建用户：
useradd -G wheel -m 用户名，其中-m参数代表自动创建用户的家目标。
passwd 用户名
```
> useradd -G wheel -m [username]
> passwd [username]
> ls /home
```

# 本地化
## 安装中文字体
ArchLinux默认没有中文字体，无法显示中文，必须手动安装
```
$ pacman -S noto-fonts-cjk noto-fonts noto-fonts-emoji wqy-microhei
```
以上选用谷歌开源字体Noto，包括中日韩字体、英文字体以及Emoji字体

## 方言
Locale数据，用于控制操作系统的本地化，以支持不同的语音、时间格式等。
首先打开Locale生成器配置：
```
> sudo vim /etc/locale.gen
# 这里提供了不少语言与对应编码，取消注释以下编码：
# en_US.UTF-8 UTF-8
# zh_CN.UTF-8 UTF-8
# zh_TW.UTF-8 UTF-8
> sudo locale-gen
> su -i
> echo LANG=zh_CN.utf8 > /etc/locale.conf
```

# 设置源
## pacman 源
```
> sudo reflector --sort rate --threads 100 -c China --save /etc/pacman.d/mirrorlist
> cat /etc/pacman.d/mirrorlist 
```
## archlinuxcn 源
Archlinuxcn是由来自我国的团队维护的软件源，主要提供官方源之外的以下实用软件：
| 软件类型                                       | 举例                                                                                                                     |
| ---------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| 闭源的免费软件                                 | Google Chrome、Android Studio、WPS Office                                                                                |
| 商业软件                                       | JetBrains全家桶（Intellij Idea、PyCharm、WebStorm）                                                                      |
| 开源软件的官方构建版                           | Visual Studio Code。Arch官方源也有，但界面和功能与微软官方版有明显区别                                                   |
| 官方源未收录的实用软件                         | NVM（Node.js版本切换工具）、Oh My Zsh（火爆的zsh增强工具）、Logisim（电路仿真工具）                                      |
| 官方源也有，但影响用户体验                     | Pandoc，官方源提供的版本会捆绑Haskell的依赖，数百兆很臃肿，一般用户用不上。Archlinuxcn则提供了静态链接的版本pandoc-bin。 |
| 从GitHub编译而来的自由软件，与官方源版本不兼容 | 一般包名有-git后缀。如Fcitx。                                                                                            |

```
> sudo vim /etc/pacman.conf
[archlinuxcn]
Server = https://mirrors.ustc.edu.cn/archlinuxcn/$arch
```
更新软件仓库
```
> sudo pacman -Sy
```
要想使用archlinuxcn，还需要安装密钥环
```
> sudo pacman -S archlinuxcn-keyring
```
如果密钥报错【GnuPG-2.1 与 pacman 密钥环】
由于升级到了 gnupg-2.1，pacman 上游更新了密钥环的格式，这使得本地的主密钥无法签署其它密钥。这不会出问题，除非你想自定义 pacman 密钥环。不过，我们推荐所有用户都生成一个新的密钥环以解决潜在问题。
此外，我们建议您安装 haveged，这是一个用来生成系统熵值的守护进程，它能加快加密软件（如 gnupg，包括生成新的密钥环）关键操作的速度。
要完成这些操作，请以 root 权限运行：
```
> pacman -Syu haveged
> systemctl start haveged
> systemctl enable haveged

> rm -rf /etc/pacman.d/gnupg
> pacman-key --init
> pacman-key --populate archlinux
> pacman-key --populate archlinuxcn
```

# 驱动
## 网络
+ dhcpcd：DHCP客户端
+ wpa_supplicant：WLAN功能
+ networkmanager：网络管理前段工具，被KDE等桌面使用
```
> pacman -S dhcpcd wpa_supplicant networkmanager
> systemctl enable dhcpcd
> systemctl enable wpa_supplicant
> systemctl enable NetworkManager
```
## 蓝牙
### 安装核心包
+ bluez
+ bluez-utils
+ pulseaudio-bluetooth
+ pulseaudio-modules-bt
```
> sudo pacman -S bluez bluez-utils pulseaudio-bluetooth pulseaudio-modules-bt
> systemctl enable bluetooth
```
### win10、arch蓝牙同步
windows
1. 下载psexec(https://docs.microsoft.com/en-us/sysinternals/downloads/psexec)
2. 管理员模式运行`psexec.exe -s -i regedit`
3. 找到如下地址HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\BTHPORT\Parameters\Keys\并记录LTK（long term key）
linux
1. 切换root，进入/var/lib/bluetooth
2. 进入根目录编辑info文件，将key切换为LTK

## 显示服务器
+ [xorg](https://wiki.archlinux.org/title/Xorg_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87))
+ wayland
### 查看显示服务器
```
> echo $XDG_SESSION_TYPE
```
### 安装xorg
```
> sudo pacman -S xorg xorg-server xorg-xinit
```
### 显卡驱动
查看显卡类型
```
> lspci | grep -e VGA -e 3D
```
查找驱动
```
pacman -Ss xf86-video
```

### xorg初始化
使用xorg.conf文件
```
> Xorg :0 -configure
> sudo mv ~/xorg.conf.new /etc/X11/xorg.conf
```
### 画面撕裂
+ [AMD](https://wiki.archlinux.org/title/Ryzen_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87))


# 配置
## 设置主机名
主机名是自己电脑的标志，在局域网中非常重要。编辑用来存放主机名的文件：
```
sudo vim /etc/hostname
```

---

lsblk

lxappearance

variety

https://wiki.archlinux.org/title/HiDPI


# 终端支持emoji
yay -S libxft-bgra


---

systemctl list-unit-files#可以列出所有的开启或未开启的服务

安装网络管理器
pacman -S networkmanager
systemctl enable NetworkManager               #使网络管理器开机自动启动
#之前安装过的关于网络的相关应用都是纯命令行形式的，而这里安装的是带有GUI的网络管理器


安装显示管理器

这个就是我们开机时候输入账号密码的那个GUI框，在没有安装archlinux之前我还真不知道这个东西需要单独安装（长期使用ubuntu的锅）

pacman -S lightdm lightdm-gtk-greeter
SDDM

pacman -S alsa-utils




U盘自动挂载：udiskie
























---

# iwd
iwd (iNet wireless daemon，iNet 无线守护程序) 是由英特尔（Intel）为 Linux 编写的一个无线网络守护程序。该项目的核心目标是不依赖任何外部库，而是最大程度地利用 Linux 内核提供的功能来优化资源利用。

iwd 可以独立工作，也可以和 ConnMan、systemd-networkd 和 NetworkManager 这样更完善的网络管理器结合使用。



# NetworkManager网络管理工具


---



























交换空间
efi
boot
swap




