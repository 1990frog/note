
是什么？有什么？能干什么？
这是个什么东西，它有哪些东西构成，这个东西到底能干什么？


jvm调优：调什么、如何调、调的目标是什么？

内存方面：
jvm需要的内存总大小
各块内存分配，新生代、老年代、存活区
选择合适的垃圾回收算法、控制GC停顿次数和时间
解决内存泄露的问题，辅助代码优化
内存热点：检查哪些对象在系统中数量最大，辅助代码优化


垃圾回收算法会造成虚拟机的停顿，影响到业务请求


线程方面
死锁检查，辅助代码优化
dump线程详细信息：查看线程内部运行情况，查找竞争线程，辅助代码优化
cpu热点：检查系统哪些方法占用了大量cpu时间，辅助代码优化


如何调优
监控jvm的状态，主要是内存、线程、代码、io几部分
分析结果，判定是否需要优化
调整：垃圾回收算法和内存分配；修改并优化代码
不断的重复监控、分析和调整，直到找到优化的平衡点


----

jvm调优的目标
+ gc的时间足够的小
+ gc的次数足够的少
+ 将转移到老年代的对象数量降低到最小
+ 减少full gc的执行时间
+ 发生full gc的间隔足够的长（至少1分钟以上）

常见调优策略
+ 减少创建对象的数量
+ 减少使用全局变量（周期长，垃圾回收很难清理掉，经过多次垃圾回收有可能进入老年代）和大对象（很快新生代就存不下这些对象了，很快就进入老年代，存在这种情况下再有大对象要分配，新生代的资源就不够，就会要求老年代进行清理，如果老年代的空间也不够就会触发gc）
+ 调整新生代、老年代的大小到最合适
+ 选择合适的gc收集器，并设置合理的参数


---

# 架构师每天都在思考什么？
如果让我的系统更快
如何避免系统出现瓶颈

招聘
参与现有系统的性能优化，重构，保证平台性能和稳定性
根据业务场景和需求，决定技术方向，做技术选型
能构独立框架和设计海量数据下高并发分布式解决方案，满足功能和非功能需求
解决各类潜在系统风险，核心功能的架构与代码编写
分析系统瓶颈，解决各种疑难杂症，性能调优等

# 字节码
java语言编译成的字节码。

支持的语言：
kotlin
clojure
groovy
scala
jpython
jruby
javascript

java平台上的多语言混合编程正成为主流，通过特定领域的语言去解决特定领域的问题是当前软件开发应对日趋复杂的项目需求的一个方向
并行处理用clojure
展示层使用jruby/rails
中间层用java
各种语言之间的交互不存在任何困难，就像使用自己语言的原生api一样方便，因为它们最终都是运行在一个虚拟机上

JIT??????

执行引擎 execution engine


java编译器
词法分析
语法分析
语法\抽象语法树
语义分析
注解抽象语法树
字节码生成器

---

java编译器输入的指令流基本上是一种基于栈的指令集架构，另外一种指令集机构则是基于寄存器的指令集机构

这两种架构之间的区别：
基于栈：
+ 设计和实现更简单，适用于资源受限的系统
+ 避开了寄存器的分配难题：使用零地址指令方式分配
+ 指令流中的指令大部分是零地址指令，其执行过程依赖于操作栈。指令集更小，编译器容易实现
+ 不需要硬件支持，可移植性更好，更好实现跨平台

基于寄存器：
+ 典型的应用是x86的二进制指令集：比如传统的pc以及android的davlik虚拟机
+ 指令集架构则完全依赖硬件，可移植性差
+ 性能优秀和执行更高效
+ 花费更少的指令去完成一项操作
+ 在大部分情况下，基于寄存器架构的指令集往往都以一地址指令、二地址指令和三地址指令为主，而基于栈式架构的指令集却是以零地址指令为主。

反编译
javap -v xxx.class

jvm 生命周期


虚拟机的启动
java虚拟机的启动是通过引导类加载器（bootstrap class loader）创建各初始类（initial class）来完成的，这个类是由虚拟机的具体实现指定的。
执行一个所谓的java程序的时候，其实是执行一个java虚拟机

类加载器？


虚拟机种类：
+ sun classic vm 1.4被淘汰（只有解释器，没有JIT编译器）
+ hostspot vm jdk默认虚拟机，通过计数器找到最具编译价值代码，触发即时编译或栈上替换。通过编译器与解释器协同工作，在最优化的程序影响时间与最佳执行性能中取得平衡
+ bea的jrockit，它可以不太关注程序启动速度，因此jrockit内部不包含解析器实现，全部代码都靠即时编译器编译后执行。大量的行业基准测试显示，jrockit是世界上最快的jvm
优势：
jrockit面向延迟敏感型应用的解决方案jrockit real time提供以毫秒或微秒级的jvm相应时间，适合财务、军事指挥、电信网络的需要
missionControl服务套件，它是一组以极低的开销来监控、管理和分析生产环境中的应用程序的工具
+ IBM J9
+ Azul VM 与特定硬件平台绑定、软硬件配合的专有虚拟机
+ Taobao JVM
+ + Graal VM 在hostspot基础上增强而成的跨语言全栈虚拟机。语言包括：java、scala、groovy、kotlin、c、c++、js、ruby、python、r等


https://www.bilibili.com/video/BV1PJ411n7xZ?p=26