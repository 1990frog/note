[TOC]

# HTTP的本质
HTTP协议是浏览器与服务器之间的数据传送协议。

作为应用层协议，HTTP是基于TCP/IP协议来传递数据的（HTML 文件、图片、查询结果等），HTTP协议不涉及数据包（Packet）传输，主要规定了客户端和服务器之间的通信格式。

假如浏览器需要从远程HTTP服务器获取一个HTML文本，在这个过程中，浏览器实际上要做两件事情。
+ 与服务器建立Socket连接。
+ 生成请求数据并通过Socket发送出去。

首先最基本的是，你要让服务端知道你的意图，你是想获取内容还是提交内容；其次你需要告诉服务端你想要哪个内容。

那么要把这些信息以一种什么样的格式放到请求里去呢？
这就是HTTP协议要解决的问题。也就是说，HTTP协议的本质就是一种浏览器与服务器之间约定好的通信格式。

# HTTP工作原理
![f5bd0c7840160d5a121c191e7e54b4ca](https://raw.githubusercontent.com/1990frog/imagebed/default/1602319001_20200402201123268_1503184010.jpg)

从图上你可以看到，这个过程是：
1. 用户通过浏览器进行了一个操作，比如输入网址并回车，或者是点击链接，接着浏览器获取了这个事件。
2. 浏览器向服务端发出 TCP 连接请求。
3. 服务程序接受浏览器的连接请求，并经过 TCP 三次握手建立连接。
4. 浏览器将请求数据打包成一个 HTTP 协议格式的数据包。
5. 浏览器将该数据包推入网络，数据包经过网络传输，最终达到端服务程序。
6. 服务端程序拿到这个数据包后，同样以 HTTP 协议格式解包，获取到客户端的意图。
7. 得知客户端意图后进行处理，比如提供静态文件或者调用服务端程序获得动态结果。
8. 服务器将响应结果（可能是 HTML 或者图片等）按照 HTTP 协议格式打包。
9. 服务器将响应数据包推入网络，数据包经过网络传输最终达到到浏览器。
10. 浏览器拿到数据包后，以 HTTP 协议的格式解包，然后解析数据，假设这里的数据是 HTML。11. 浏览器将 HTML 文件展示在页面上

在上面的过程中tomcat和jetty做了什么？
主要是接受连接、解析请求数据、处理请求和发送响应这几个步骤

# HTTP请求响应实例
请求实例
![f58bf57649ec9eb35eb24e0679bb2514](https://raw.githubusercontent.com/1990frog/imagebed/default/1602319002_20200402201544756_1001422378.png)

HTTP 请求数据由三部分组成，分别是请求行、请求报头、请求正文。当这个 HTTP 请求数据到达 Tomcat 后，Tomcat 会把 HTTP 请求数据字节流解析成一个 Request 对象，这个 Request 对象封装了 HTTP 所有的请求信息。接着 Tomcat 把这个 Request 对象交给 Web 应用去处理，处理完后得到一个 Response 对象，Tomcat 会把这个 Response 对象转成 HTTP 格式的响应数据并发送给浏览器。

响应实例
![84f4fe4c411dfb9fd83a1d53cf2915b7](https://raw.githubusercontent.com/1990frog/imagebed/default/1602319003_20200402201737201_347474675.png)

# 无状态
HTTP 协议有个特点是无状态，请求与请求之间是没有关系的。
这样会出现一个很尴尬的问题：Web 应用不知道你是谁。

比如你登陆淘宝后，在购物车中添加了三件商品，刷新一下网页，这时系统提示你仍然处于未登录的状态，购物车也空了，很显然这种情况是不可接受的。


HTTP 是信封，信封里面的信（HTML）才是内容；但是没有信封，信也没办法寄出去。HTTP 协议就是浏览器与服务器之间的沟通语言，具体交互过程是请求、处理和响应。

# keepalive
在 HTTP/1.0 时期，每次 HTTP 请求都会创建一个新的 TCP 连接，请求完成后之后这个 TCP 连接就会被关闭。

这种通信模式的效率不高，所以在 HTTP/1.1 中，引入了 HTTP 长连接的概念，使用长连接的 HTTP 协议，会在响应头加入 Connection:keep-alive。

这样当浏览器完成一次请求后，浏览器和服务器之间的 TCP 连接不会关闭，再次访问这个服务器上的网页时，浏览器会继续使用这一条已经建立的连接，也就是说两个请求可能共用一个 TCP 连接。