[TOC]

是CPU指令级的操作

CAS（Compare and Swap），即比较并替换，实现并发算法时常用到的一种技术，Doug lea大神在java同步器中大量使用了CAS技术，鬼斧神工的实现了多线程执行的安全性。

CAS的思想很简单：三个参数，一个当前内存值V、旧的预期值A、即将更新的值B，当且仅当预期值A和内存值V相同时，将内存值修改为B并返回true，否则什么都不做，并返回false。

# 三个基本元素
+ 内存地址V
+ 旧的预期值A
+ 要修改的新值B

当且仅当变量的预期值A和内存地址V当中的实际值相同时，才会将内存地址V对应的值修改为B 。
# 缺点
## CPU开销较大
在并发量比较高的情况下，如果许多线程反复尝试更新某个变量，却一直不成功，循环往复，会给CPU带来很大的压力。
## 不能保证代码块的原子性
CAS机制所保证的只是一个变量的原子性操作，而不能保证整个代码块的原子性。
比如需要保证3个变量共同进行原子性的更新，就不得不使用Synchronized了。
## ABA问题
当一个值从A更新成B，又更新会A，普通CAS机制会误判通过检测。

如果在这段期间曾经被改成B，然后又改回A，那CAS操作就会误认为它从来没有被修改过。针对这种情况，java并发包中提供了一个带有标记的原子引用类AtomicStampedReference，它可以通过控制变量值的版本来保证CAS的正确性。