# Demo
## sentinel主要配置
```config
port ${port}
daemonize yes
dir "/opt/soft/redis/data/"
logfile "${port}.log"
# 主节点名字，ip，端口，几个sentinel发现master有问题发生故障转移
sentinel monitor mymaster 127.0.0.1 7000 2
# 30000ms ping不通确认有问题
sentinel down-after-milliseconds mymaster 30000
# 一次复制一个
sentinel parallel-syncs mymaster 1
#
sentinel failover-timeout mymaster 180000
```
## Reids主/从节点

主节点：
```config
port 7000
daemonize yes
pidfile /var/run/redis-7000.pid
logfile "7000.log"
dir "/opt/soft/redis/data/7000/"
```

从节点1：
```config
port 7001
daemonize yes
pidfile /var/run/redis-7001.pid
logfile "7001.log"
dir "/opt/soft/redis/data/7001/"
slavof 127.0.0.1 7000
```

从节点2：
```config
port 7002
daemonize yes
pidfile /var/run/redis-7002.pid
logfile "7002.log"
dir "/opt/soft/redis/data/7002/"
slavof 127.0.0.1 7000
```

技巧：
```config
sed "s/7000/7001/g" redis-7000.conf > redis-7001.conf
sed "s/7000/7002/g" redis-7000.conf > redis-7002.conf
echo "slaveof 127.0.0.1 7000" >> redis-7001.conf
echo "slaveof 127.0.0.1 7000" >> redis-7002.conf
ps -ef | grep redis-server | grep 700
```
## 安装sentinel
```config
cat sentinel.conf | grep -v "#" | grep -v "^$" > redis-sentinel-26379.conf
redis-sentinel redis-sentinel-26379.conf
ping
info
```
sentinel的配置会被重写：
```
# Generated by CONFIG REWRITE
sentinel know-slave mymaster 127.0.0.1 7001
sentinel know-slave mymaster 127.0.0.1 7002
sentinel current-epoch 0
还有部分配置被去掉了
```
多sentinel配置：
```
sed "s/26379/26380/g" redis-sentinel-26379.conf > redis-sentinel-26380.conf
sed "s/26379/26381/g" redis-sentinel-26379.conf > redis-sentinel-26381.conf
```

# 启动
redis-sentinel *.conf